eslint:
  stage: analyzes
  tags:
    - bff

  # –ß—ë—Ç–∫–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ (10 –º–∏–Ω—É—Ç)
  timeout: 10m

  # –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ–º —É—Å—Ç–∞–Ω–æ–≤–∫—É: –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫—ç—à, –∏–∑–±–µ–≥–∞–µ–º –ª–∏—à–Ω–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
  cache:
    key: ${CI_JOB_NAME}
    paths:
      - node_modules/
    policy: pull-push  # —Å–Ω–∞—á–∞–ª–∞ –ø—ã—Ç–∞–µ–º—Å—è –∑–∞–±—Ä–∞—Ç—å, –ø–æ—Ç–æ–º —Å–æ—Ö—Ä–∞–Ω—è–µ–º
  
  script:
    - echo "üîç –ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É ESLint..."
    - echo "–¢–µ–∫—É—â–∏–π –±—Ä–∞–Ω—á $CI_COMMIT_BRANCH"
    - echo "SHA –∫–æ–º–º–∏—Ç–∞ $CI_COMMIT_SHA"

    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ—Ç –∫—ç—à–∞ –∏–ª–∏ –æ–Ω —É—Å—Ç–∞—Ä–µ–ª
    - if [ ! -d "node_modules" ] || [ ! -f "package-lock.json" ]; then npm ci; fi

    - npm install -D eslint-formatter-unix
    # –ó–∞–ø—É—Å–∫–∞–µ–º ESLint —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –≤—ã–≤–æ–¥–æ–º –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    - npm run lint -- --format=unix --output-file=lint-results.txt
    - echo "‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ ESLint –∑–∞–≤–µ—Ä—à–µ–Ω–∞."

    # –í—ã–≤–æ–¥–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –æ—Ü–µ–Ω–∫–∏ –≤ –ª–æ–≥–µ
    - |
      ERROR_COUNT=$(grep -c "^" lint-results.txt || echo 0)
      echo "–ù–∞–π–¥–µ–Ω–æ –æ—à–∏–±–æ–∫ ESLint: $ERROR_COUNT"
      if [ "$ERROR_COUNT" -gt 0 ]; then
        echo "‚ö†Ô∏è  –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –æ—à–∏–±–∫–∏ ESLint. –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –≤ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–µ lint-results.txt"
      else
        echo "‚úîÔ∏è ESLint: –Ω–µ—Ç –æ—à–∏–±–æ–∫."
      fi

  artifacts:
    when: always
    paths:
      - lint-results.txt
    expire_in: 1 week

  rules:
    - if: $CI_COMMIT_BRANCH == "re-2026"

  # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: –º–µ—Ç–∫–∏ –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
  variables:
    GIT_STRATEGY: fetch
